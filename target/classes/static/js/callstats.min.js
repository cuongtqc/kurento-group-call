/***
Copyright (c) 2013-2016, Dialogue.io
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats.js  version = 3.15.5 2016-08-31 */
!function(a){"use strict";var b=function(a,b){function c(){var a=(Math.random()+1).toString(36);return a.substring(2,a.length)}function d(){return window.performance.now?window.performance.now()+window.performance.timing.navigationStart:Date.now()}function e(){var a=d();return a+Va.currentOffset}function f(){return window.performance.now?window.performance.now():null}function g(){"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(a){pa=a})}function h(){return pa?pa.level:void 0}function i(){return pa?pa.charging:void 0}function j(){navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&navigator.mediaDevices.enumerateDevices().then(function(a){oa=a})}function k(){Ca||window.addEventListener("beforeunload",function(a){var b;for(b in Ta)Ta.hasOwnProperty(b)&&Ob(eb.userLeft,null,b,Ta[b].ucID,null,null,null);return"Are you sure you want to close the call?"})}function l(a,b){setTimeout(function(){var b=e(),c=b-a.data.apiTS;a.data.timeShift=c,ia(a.type,a.action,a.data,a.callback)},b)}function m(a,b,c,d,e){var g=$b(c,d),h=null;g?(h=f(),Ob(eb.mediaPlaybackStartEvent,b,c,a,{ssrc:e,highResTs:h},g,null)):console.error("sendMediaStartEvent: Invalid pcHash")}function n(a,b,c,d,e){var g=$b(c,d),h=null;g?(h=f(),Ob(eb.mediaSuspendedEvent,b,c,a,{ssrc:e,highResTs:h},g,null)):console.error("sendMediaSuspendedEvent: Invalid pcHash")}function o(a,b,c,d,e){var f=document.getElementById(c);if(f){var g=Ta[b].ucID;f.oncanplay=function(){m(g,a,b,d,e)},f.onsuspend=function(){n(g,a,b,d,e)}}}function p(a){var b=Qa.codebase,c=!1;if(null===a)c=!1;else if(b===xb.firefox){var d=typeof mozRTCPeerConnection,e=typeof RTCPeerConnection;"undefined"!==d&&a instanceof mozRTCPeerConnection?c=!0:"undefined"!==e&&a instanceof RTCPeerConnection&&(c=!0)}else null!==cb&&a instanceof cb&&(c=!0),("function"==typeof a||b===xb.edge)&&(c=!0);return c}function q(a,b){var c;return a&&(b===xb.chrome?(c=a.googLocalAddress,c.concat(":",a.googRemoteAddress)):b===xb.firefox&&(c=a.localAddr,c.concat(":",a.remoteAddr))),Ub(c)}function r(){var a;return a=navigator.onLine===!0?"online":"offline"}function s(a,b){var c=yb.unknown,d=null;if(b===xb.chrome)void 0!==a&&(void 0!==a.data.googFrameRateReceived||void 0!==a.data.googFrameRateSent?c=yb.video:(void 0!==a.data.audioInputLevel||void 0!==a.data.audioOutputLevel)&&(c=yb.audio),d=a.data.googCodecName);else{if(b!==xb.firefox)return;void 0!==a&&(void 0!==a.data.mediaType?c=a.data.mediaType:void 0!==a.data.framerateMean&&(c=yb.video))}return Ya.hasOwnProperty(a.data.ssrc)&&(Ya[a.data.ssrc].mediaType=c,Ya[a.data.ssrc].codec=d),c}function t(a,b){var c;return b===xb.chrome?void 0!==a.data.googFrameRateOutput?c=parseInt(a.data.googFrameRateOutput,10):void 0!==a.data.googFrameRateDecoded?c=parseInt(a.data.googFrameRateDecoded,10):void 0!==a.data.googFrameRateReceived?c=parseInt(a.data.googFrameRateReceived,10):void 0!==a.data.googFrameRateSent&&(c=parseInt(a.data.googFrameRateSent,10)):b===xb.firefox&&void 0!==a.data.framerateMean&&(c=parseInt(a.data.framerateMean,10)),void 0!==c&&(c=isNaN(c)||0>c?null:c),c}function u(a,b){var c="unavailable";if(b===xb.chrome){var d,e,f;d=t(a,b),void 0!==a.data.googFrameWidthReceived?f=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(f=a.data.googFrameWidthSent),void 0!==a.data.googFrameHeightReceived?e=a.data.googFrameHeightReceived:void 0!==a.data.googFrameHeightSent&&(e=a.data.googFrameHeightSent),void 0!==d&&void 0!==f&&void 0!==e&&f>0&&e>0&&(c=f.concat("x",e,"@",d))}else b===xb.firefox;return c}function v(a,b){var c;return b===xb.chrome?void 0!==a.data.googFrameWidthReceived?c=a.data.googFrameWidthReceived:void 0!==a.data.googFrameWidthSent&&(c=a.data.googFrameWidthSent):b===xb.firefox,c}function w(a){var b;return b=isNaN(a)||0>a?null:a}function x(a,b){var c;if(b===xb.chrome){if(void 0!==a&&void 0!==a.data.googRtt)return c=w(parseInt(a.data.googRtt,10))}else if(b===xb.firefox){if(void 0!==a&&void 0!==a.data.mozRtt)return c=w(parseInt(a.data.mozRtt,10))}else if(b===xb.edge&&a&&a.data.roundTripTime)return c=w(parseInt(a.data.roundTripTime,10))}function y(a){var b=isNaN(a)?null:a;return b}function z(a,b){var c;if(b===xb.chrome){if(void 0!==a&&void 0!==a.data.googJitterReceived)return c=y(parseInt(a.data.googJitterReceived,10)),c&&(c/=1e3),c}else if(b===xb.firefox&&void 0!==a&&void 0!==a.data.jitter)return c=y(parseInt(a.data.jitter,10))}function A(a,b){if(b.sort(),b.length>0){var c=a/100*b.length;c=Math.ceil(c);var d=b[c-1];return d}}function B(a,b,c){var d;return b===yb.audio?a<c.audio.gThreshold?d=nb.excellent:a>c.audio.gThreshold&&a<c.audio.rThreshold?d=nb.fair:a>c.audio.rThreshold&&(d=nb.bad):b===yb.video&&(a<c.video.gThreshold?d=nb.excellent:a>c.video.gThreshold&&a<c.video.rThreshold?d=nb.fair:a>c.video.rThreshold&&(d=nb.bad)),d}function C(a,b,c){var d;return b===yb.audio?a>c.audio.gThreshold?d=nb.excellent:a>c.audio.rThreshold&&a<c.audio.gThreshold?d=nb.fair:a<c.audio.rThreshold&&(d=nb.bad):b===yb.video&&(a>c.video.gThreshold?d=nb.excellent:a>c.video.rThreshold&&a<c.video.gThreshold?d=nb.fair:a<c.video.rThreshold&&(d=nb.bad)),d}function D(){var a,b,c=0,d=0;for(a=0;a<arguments.length;a++)void 0!==arguments[a]&&null!==arguments[a]&&(c+=arguments[a],d++);return d>0&&(c/=d,c=Math.floor(c),c===nb.excellent?b=ob.excellent:c===nb.fair?b=ob.fair:c===nb.bad&&(b=ob.bad)),b}function E(a,b,c){var d,e,f,g,h,i,j,k,l,m=[];if(void 0!==a.lastStatsSent&&void 0!==a.lastStatsSent.statistics.Transport)for(f=a.lastStatsSent.statistics.Transport,g=a.latestEventSent,h=void 0,d=0;d<b.length;d++){for(k={},h=void 0,e=0;e<f.length;e++)if(b[d].hash===f[e].hash){h=f[e];break}void 0!==h&&(i=parseInt(h.bytesReceived,10),j=parseInt(h.bytesSent,10),k.hash=b[d].hash,l=c-g,l>0&&(k.receivedBwKbps=8*(parseInt(b[d].bytesReceived,10)-i)/l,k.sentBwKbps=8*(parseInt(b[d].bytesSent,10)-j)/l,void 0!==h.packetsSent&&void 0!==b[d].packetsSent&&(k.sentPacketRate=(parseInt(b[d].packetsSent,10)-parseInt(h.packetsSent,10))/(l/1e3)),void 0!==h.packetsReceived&&void 0!==b[d].packetsReceived&&(k.receivedPacketRate=(parseInt(b[d].packetsReceived,10)-parseInt(h.packetsReceived,10))/(l/1e3))),k.rtt=b[d].googRtt,m.push(k))}return m}function F(a,b,c,d){var e=[];return c===xb.firefox?e=null:c===xb.chrome&&(e=E(a,b,d)),e}function G(a){if(a=y(a),null!==a){var b=0>a?null:a;return b}}function H(a,b,c,d,e,f,g){return void 0===a[c]&&(a[c]={}),void 0===a[c].streams&&(a[c].streams={}),void 0===a[c].streams[b]&&(a[c].streams[b]={}),void 0===a[c].streams[b][e]&&(a[c].streams[b][e]={}),void 0===a[c].streams[b][e][d]&&(a[c].streams[b][e][d]={}),void 0===a[c].streams[b][e][d].totalTimeMs&&(g?a[c].streams[b][e][d][f]=[]:a[c].streams[b][e][d][f]=0),a}function I(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,w,z,E,F,I,J,L,M,N,O,P,Q=null,R=null,S=null,T=b.reportType,U=null,V=null,W=null,X=null,Y=null,Z=null,$=null,_=null,aa=null,ba=b.data,ca=K(c.streams,b.ssrc,"outbound",T);ca?(h=y(parseInt(ca.data.bytesSent,10)),i=a.lastStatsSent.apiTS,F=y(parseInt(ca.data.packetsSent,10)),J=y(parseInt(ca.data.packetsLost,10)),L=y(parseInt(ca.data.discardedPackets,10))):(h=0,i=e,J=0,F=0,L=0),k=e,w=k-i,m=s(b,d),n=u(b,d),o=t(b,d),p=v(b,d),l=x(b,d),j=y(parseInt(ba.bytesSent,10)),null!==j&&null!==h&&h>j&&(h=0,Bb(va,wa,"log",{msg:"getstats: curBytesSent < prevBytesSent counter reset",conferenceID:f,ucID:g})),void 0!==ba.droppedFrames&&(M=G(parseInt(ba.droppedFrames,10)),null!==M&&null!==L&&L>M&&(L=0),null!==M&&null!==L&&(N=M-L)),I=G(parseInt(ba.packetsLost,10)),null!==I&&null!==J&&(R=I-J),E=G(parseInt(ba.packetsSent,10)),null!==E&&null!==F&&(z=E-F),void 0!==R&&void 0!==z&&z+R>0&&(S=R/(z+R)),w>0&&(null!==j&&null!==h&&(Q=8*(j-h)/w),void 0!==z&&(aa=z/(w/1e3)));var da=b.ssrc;a=H(a,da,"rttInfo",T,"outbound","rttArray",!0),a=H(a,da,"fractionalLossInfo",T,"outbound","fractionalLossArray",!0),a=H(a,da,"timeElapse",T,"outbound","totalTimeMs",!1),a=H(a,da,"frameWidthInfo",T,"outbound","frameWidthArray",!0),a=H(a,da,"frameRateInfo",T,"outbound","frameRateArray",!0),void 0!==l&&null!==l&&a.rttInfo.streams[da].outbound[T].rttArray.push(parseInt(l,10)),void 0!==S&&null!==S&&a.fractionalLossInfo.streams[da].outbound[T].fractionalLossArray.push(S),void 0!==o&&null!==o&&a.frameRateInfo.streams[da].outbound[T].frameRateArray.push(parseInt(o,10)),void 0!==p&&null!==p&&a.frameWidthInfo.streams[da].outbound[T].frameWidthArray.push(parseInt(p,10)),U=A(95,a.rttInfo.streams[da].outbound[T].rttArray),X=A(95,a.fractionalLossInfo.streams[da].outbound[T].fractionalLossArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[da].outbound[T].totalTimeMs=a.timeElapse.streams[da].outbound[T].totalTimeMs+w),a.timeElapse.streams[da].outbound[T].totalTimeMs>0&&null!==j&&(_=8*j/a.timeElapse.streams[da].outbound[T].totalTimeMs);var ea={csioIntMs:w,csioIntFL:S,csioIntPR:aa,csioIntBRKbps:Q,csioMediaType:m,csioSig2Latency:U,csioAvgBRKbps:_,csioTimeElapseMs:a.timeElapse.streams[da].outbound[T].totalTimeMs,csioRes:n,csioPercentileFl:X,csioIntFramesDropped:N};for(O in ba)ba.hasOwnProperty(O)&&(ea[O]=ba[O]);return m===yb.audio?(P=U+40,V=B(P,m,wb),W=C(Q,m,sb),q=D(V,W),ea.csioMark=q,ea.csioeM=P):m===yb.video&&(ea.csioPercentileFrameWidth=A(95,a.frameWidthInfo.streams[da].outbound[T].frameWidthArray),ea.csioPercentileFrameRate=A(95,a.frameRateInfo.streams[da].outbound[T].frameRateArray),r=parseInt(a.rttInfo.streams[da].outbound[T].frameRate,10),Y=C(o/r,m,tb),Z=B(l,m,ub),$=C(Q,m,sb),q=D(Y,Z,$),a.rttInfo.streams[da].outbound[T].frameRate=o,ea.csioMark=q),ea}function J(a,b,c,d,e,f,g){var h,i,j,k,l,m,n,o,p,q,r,w,E,F,I,J,L,M,N,O,P,Q,R,S,T,U,V=null,W=null,X=b.reportType,Y=null,Z=null,$=null,_=null,aa=null,ba=null,ca=null,da=null,ea=null,fa=b.data,ga=K(c.streams,b.ssrc,"inbound",X);ga?(h=y(parseInt(ga.data.bytesReceived,10)),l=y(parseInt(ga.data.packetsLost,10)),O=y(parseInt(ga.data.packetsReceived,10)),i=a.lastStatsSent.apiTS,Q=y(parseInt(ga.data.discardedPackets,10))):(h=0,i=e,l=0,O=0,Q=0),o=s(b,d),p=u(b,d),r=t(b,d),q=z(b,d),U=v(b,d),n=x(b,d),j=y(parseInt(fa.bytesReceived,10)),null!==j&&null!==h&&h>j&&(h=0,l=0,O=0,Bb(va,wa,"log",{msg:"getstats: curBytesReceived < prevBytesReceived counter reset",conferenceID:f,ucID:g})),m=G(parseInt(fa.packetsLost,10)),null!==m&&null!==l&&(W=m-l),k=e,void 0!==fa.discardedPackets&&(P=G(parseInt(fa.discardedPackets,10)),null!==P&&null!==Q&&Q>P&&(Q=0),null!==P&&null!==Q&&(R=P-Q)),N=G(parseInt(fa.packetsReceived,10)),w=N-O,void 0!==W&&null!==w&&w+W>0&&(Z=W/(w+W)),M=k-i,M>0&&(null!==j&&null!==h&&(V=8*(j-h)/M),null!==w&&(Y=w/(M/1e3)));var ha=b.ssrc;a=H(a,ha,"rttInfo",X,"inbound","rttArray",!0),a=H(a,ha,"timeElapse",X,"inbound","totalTimeMs",!1),a=H(a,ha,"jitterInfo",X,"inbound","jitterArray",!0),a=H(a,ha,"fractionalLossInfo",X,"inbound","fractionalLossArray",!0),a=H(a,ha,"frameWidthInfo",X,"inbound","frameWidthArray",!0),a=H(a,ha,"frameRateInfo",X,"inbound","frameRateArray",!0),void 0!==n&&null!==n&&a.rttInfo.streams[ha].inbound[X].rttArray.push(parseInt(n,10)),void 0!==q&&null!==q&&a.jitterInfo.streams[ha].inbound[X].jitterArray.push(parseInt(q,10)),void 0!==Z&&null!==Z&&a.fractionalLossInfo.streams[ha].inbound[X].fractionalLossArray.push(Z),void 0!==r&&null!==r&&a.frameRateInfo.streams[ha].inbound[X].frameRateArray.push(parseInt(r,10)),void 0!==U&&null!==U&&a.frameWidthInfo.streams[ha].inbound[X].frameWidthArray.push(parseInt(U,10)),$=A(95,a.rttInfo.streams[ha].inbound[X].rttArray),_=A(95,a.jitterInfo.streams[ha].inbound[X].jitterArray),aa=A(95,a.fractionalLossInfo.streams[ha].inbound[X].fractionalLossArray),null!==j&&null!==h&&j>h&&(a.timeElapse.streams[ha].inbound[X].totalTimeMs=a.timeElapse.streams[ha].inbound[X].totalTimeMs+M),null!==j&&a.timeElapse.streams[ha].inbound[X].totalTimeMs>0&&(ea=8*j/a.timeElapse.streams[ha].inbound[X].totalTimeMs);var ia={csioIntMs:M,csioIntFL:Z,csioIntPR:Y,csioIntBRKbps:V,csioSig2Latency:$,csioAvgBRKbps:ea,csioMediaType:o,csioTimeElapseMs:a.timeElapse.streams[ha].inbound[X].totalTimeMs,csioIntPktRcv:w,csioIntPktLoss:W,csioPercentileJitter:_,csioRes:p,csioPercentileFl:aa,csioIntPktDiscarded:R};for(S in fa)fa.hasOwnProperty(S)&&(ia[S]=fa[S]);return o===yb.audio?(T=$+40,ba=B(T,o,wb),ca=B(Z,o,vb),da=C(V,o,sb),E=D(ba,ca,da),ia.csioMark=E,ia.csioeM=T):o===yb.video&&(ia.csioPercentileFrameRate=A(95,a.frameRateInfo.streams[ha].inbound[X].frameRateArray),ia.csioPercentileFrameWidth=A(95,a.frameWidthInfo.streams[ha].inbound[X].frameWidthArray),F=a.rttInfo.streams[ha].inbound[X].frameRate,I=C(r/F,o,tb),J=B(n,o,ub),L=C(V,o,sb),E=D(I,J,L),a.rttInfo.streams[ha].inbound[X].frameRate=r,ia.csioMark=E),ia}function K(a,b,c,d){var e=a.filter(function(a){return a.ssrc===b&&a.streamType===c&&a.reportType===d});return e.length>0?e[0]:null}function L(a,b,c,d,e,f){var g={streams:[]};g.fabricState=a.pcState,g.connectionState=r();var h=null;return h=a.lastStatsSent?a.lastStatsSent.statistics:{streams:[]},b.streams.forEach(function(b){var i={cname:b.cname,usage:b.usage,msid:b.msid,userID:b.userID,associatedVideoTag:b.associatedVideoTag,ssrc:b.ssrc,streamType:b.streamType,reportType:b.reportType};"inbound"===b.streamType?i.data=J(a,b,h,c,d,e,f):i.data=I(a,b,h,c,d,e,f),g.streams.push(i)}),g}function M(a){var b,c,d;for(b in a.streams)if(a.streams.hasOwnProperty(b)){if(a.streams[b].inbound)for(d in a.streams[b].inbound)a.streams[b].inbound.hasOwnProperty(d)&&(c=a.streams[b].inbound[d].mark,c===ob.bad?a.streams[b].inbound[d].mark=2:c===ob.fair?a.streams[b].inbound[d].mark=1:a.streams[b].inbound[d].mark=0);if(a.streams[b].outbound)for(d in a.streams[b].outbound)a.streams[b].outbound.hasOwnProperty(d)&&(c=a.streams[b].outbound[d].mark,c===ob.bad?a.streams[b].outbound[d].mark=2:c===ob.fair?a.streams[b].outbound[d].mark=1:a.streams[b].outbound[d].mark=0)}return a}function N(a,b,c){var d,e,f;for(d=0;d<a.length;d++)e=b[a[d].localCandidateId],f=c[a[d].remoteCandidateId],a[d].localAddr=e.ipAddress+":"+e.portNumber,a[d].remoteAddr=f.ipAddress+":"+f.portNumber,a[d].localAddrType=e.candidateType,a[d].remoteAddrType=f.candidateType,a[d].transportType=e.transport;return a}function O(a){var b={};return a.connectionState&&(b.connectionState=a.connectionState),a.fabricState&&(b.fabricState=a.fabricState),Ba&&(b.conferenceURL=Ba),b.streams={},a.streams.forEach(function(a){var c={cname:a.cname,ssrc:a.ssrc,msid:a.msid,remoteUserID:a.userID,usageLabel:a.usage,associatedVideoTag:a.associatedVideoTag};"inbound"===a.streamType?(a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel)):(a.data.hasOwnProperty("csioIntFL")&&(c.fractionLoss=a.data.csioIntFL),a.data.hasOwnProperty("csioIntBRKbps")&&(c.bitrate=a.data.csioIntBRKbps),a.data.hasOwnProperty("csioMark")&&(c.quality=a.data.csioMark),a.data.hasOwnProperty("csioMediaType")&&(c.mediaType=a.data.csioMediaType),a.data.hasOwnProperty("googRtt")&&(c.rtt=a.data.googRtt),a.data.hasOwnProperty("mozRtt")&&(c.rtt=a.data.mozRtt),a.data.hasOwnProperty("roundTripTime")&&(c.rtt=a.data.roundTripTime),a.data.hasOwnProperty("jitter")&&(c.jitter=a.data.jitter),a.data.hasOwnProperty("googJitterReceived")&&(c.jitter=a.data.googJitterReceived),a.data.hasOwnProperty("audioInputLevel")&&(c.audioInputLevel=a.data.audioInputLevel),a.data.hasOwnProperty("audioOutputLevel")&&(c.audioOutputLevel=a.data.audioOutputLevel)),b.streams[a.ssrc]=c}),b}function P(a,b,c,d,f,g){var h=e();a.hasOwnProperty("token")&&a.hasOwnProperty("ucID")&&ha()&&!Wa?(ia(fb.processedStats,db.fabricStats,a,g),b.latestEventSent=h,b.lastFabricState=b.pcState):(a.clockUnsynced=Wa,Jb({type:fb.processedStats,action:db.fabricStats,data:a}),a.hasOwnProperty("token")||Pa.sendAuthenticationRequest(va,f))}function Q(a,b,c,f,g,j,k){function l(l){var m=e(),n=d();void 0===j.lastRawStatsSentInterval||null===j.lastRawStatsSentInterval?j.lastRawStatsSentInterval=n-j.statsPollingStart:j.lastRawStatsSentInterval=n-j.rawstatsTS+j.lastRawStatsSentInterval,void 0===j.lastProcessedStatsSentInterval||null===j.lastProcessedStatsSentInterval?j.lastProcessedStatsSentInterval=n-j.statsPollingStart:j.lastProcessedStatsSentInterval=n-j.rawstatsTS+j.lastProcessedStatsSentInterval,j.rawstatsTS=n;var o={},p=Qa.codebase;o.version=ua,o.appID=va,o.conferenceID=encodeURIComponent(f),o.apiTS=m,o.timeShift=0,o.fabricState=j.pcState,o.pcID=j.pcHash,void 0!==g&&(o.ucID=g),Pa.authToken?o.token=Pa.authToken:Pa.sendAuthenticationRequest(va,b),o.localID=encodeURIComponent(b),o.remoteID=encodeURIComponent(c),o.deviceID=Aa;var r,s,t,u,v,w,x,y={streams:[]},z=null,A=!1,B=!1,C={},D={};for(z=bc(l),r=0;r<z.length;++r)if(s=V(z[r]),t=S(JSON.parse(s),p),!W(t))if(t.hasOwnProperty("Transport"))u="Transport",y.hasOwnProperty(u)||(y[u]=[]),p!==xb.firefox?(parseInt(t[u].bytesReceived,10)>0||parseInt(t[u].bytesSent,10)>0)&&(y[u].push(t[u]),"true"===t[u].googActiveConnection&&(o.activeConnectionIndex=y[u].length)):(y[u].push(t[u]),"true"===t[u].selected&&(o.activeConnectionIndex=y[u].length));else if(t.hasOwnProperty("localCandidate"))C[t.localCandidate.id]=t.localCandidate;else if(t.hasOwnProperty("remoteCandidate"))D[t.remoteCandidate.id]=t.remoteCandidate;else if(t.hasOwnProperty("bwe"))y.bwe=t.bwe;else{w=Lb(t.ssrc),void 0!==w&&w.localStartTime||(x=Nb(c,f,g,j,k,null),x&&(B=!0),w=Lb(t.ssrc)),w&&(v=w.remoteUserID),void 0===v&&(v=c);var E={userID:v,data:t.data,reportType:t.reportType,streamType:t.streamType,ssrc:t.ssrc};void 0!==w&&(E.cname=w.cname,E.msid=w.msid,E.associatedVideoTag=w.associatedVideoTag,E.usage=w.usageLabel),y.streams.push(E)}p===xb.firefox&&(y.Transport=N(y.Transport,C,D));var G;if(y.Transport)for(G=0;G<y.Transport.length;G++)y.Transport[G].hash=q(y.Transport[G],p);o.statistics=y,y.Transport&&(A=U(y.Transport,j)),A&&gc(k,eb.updatedConfiguration,f),j.pcState===pb.disrupted&&Z(o);var H=L(j,y,p,m,f,g);if(y.Transport&&(H.Transport=F(j,y.Transport,p,m)),y.bwe&&(H.bwe=y.bwe),void 0===j.processedStatsTupleArray&&(j.processedStatsTupleArray=[]),qa){var I=O(H);qa(I)}H.apiTS=m,H.batteryStatus={},H.batteryStatus.batteryLevel=h(),H.batteryStatus.isBatteryCharging=i(),H=M(H),j.processedStatsTupleArray.push(H),o.processedStatistics=j.processedStatsTupleArray,j.lastStatsSent=o;var J=ka(o),K=ka(o);delete J.processedStatistics,delete K.statistics,B&&Ob(eb.ssrcMap,c,f,g,Mb(),j.pcHash),(j.lastProcessedStatsSentInterval>=Fa||j.initialPhaseOver)&&(j.processedStatsTupleArray=[],P(K,j,f,c,b,a),j.lastProcessedStatsSentInterval=0)}return l}function R(a){var b;return qb.hasOwnProperty(a)?a===qb.createOffer||a===qb.createAnswer||a===qb.setRemoteDescription?b=rb.negotiationFailure:a===qb.setLocalDescription?b=rb.sdpError:a===qb.addIceCandidate?b=rb.sdpError:a===qb.getUserMedia?b=rb.mediaConfigError:a===qb.iceConnectionFailure?b=rb.iceFailure:a===qb.signalingError?b=rb.signalingError:(a===qb.applicationLog||qb.applicationError)&&(b=rb.applicationLog):b=Cb.invalidWebRTCFunctionName,b}function S(a,b){var c={};return b===xb.firefox?"inboundrtp"===a.type||"outboundrtp"===a.type?(c.ssrc=a.ssrc,c.streamType="inboundrtp"===a.type?"inbound":"outbound",c.data=a,c.mediaType=a.mediaType,c.reportType="true"===a.isRemote?"remote":"local"):"candidatepair"===a.type&&a.selected?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a):b===xb.chrome?"ssrc"===a.type?(c.reportType="local",a.bytesSent?c.streamType="outbound":c.streamType="inbound",c.ssrc=a.ssrc,c.data=a):"googCandidatePair"===a.type?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type?c.remoteCandidate=a:"VideoBwe"===a.type&&(c.bwe=a):b===xb.edge&&("inbound-rtp"===a.type||"outbound-rtp"===a.type?(c.ssrc=a.ssrc,c.streamType="inbound-rtp"===a.type?"inbound":"outbound",c.data=a,c.reportType="local"):"transport"===a.type?c.Transport=a:"localcandidate"===a.type?c.localCandidate=a:"remotecandidate"===a.type&&(c.remoteCandidate=a)),c}function T(a){var b="None";switch(a){case 0:b="TURN/TLS";break;case 1:b="TURN/TCP";break;case 2:b="TURN/UDP"}return b}function U(a,b){var c,d,e,f,g,h,i,j,k=!1,l="None",m=!1,n=function(a){var b=a.typePreference>>24;return"rtp"===a.protocol&&a.address===c?(b>=0&&2>=b&&(l=T(b)),!0):!1};for(i=0;i<a.length;i++)if(j=a[i],navigator.mozGetUserMedia&&"candidatepair"===j.type&&"true"===j.selected?(m=!0,c=j.localAddr,d=j.remoteAddr,e=j.localAddrType,f=j.remoteAddrType,g=j.transportType):"googCandidatePair"===j.type&&"true"===j.googActiveConnection&&(m=!0,c=j.googLocalAddress,d=j.googRemoteAddress,e=j.googLocalCandidateType,f=j.googRemoteCandidateType,g=j.googTransportType),m){h=0===c.indexOf("["),b.iceCandidates.some(n);break}var o=b.transportData;return(void 0===o||o.localAddr!==c||o.remoteAddr!==d||o.localAddrType!==e||o.remoteAddrType!==f||o.transportType!==g)&&(b.transportData={localAddr:c,remoteAddr:d,localAddrType:e,remoteAddrType:f,transportType:g,ipv6:h,relayType:l},k=!0),k}function V(a){var b="";b+='{"Timestamp":"',b+=a.timestamp instanceof Date?a.timestamp.getTime().toString():a.timestamp,b+='",',a.type&&(b+='"type" : "'+a.type+'",');var c=0;if(a.names){var d=a.names();for(c=0;c<d.length;++c)b+='"',b+=d[c],b+='" : "',b+=a.stat(d[c]),b+='"',c+1!==d.length&&(b+=",")}else{var e=Object.keys(a).length;c=0;var f;for(f in a)a.hasOwnProperty(f)&&(c++,"timestamp"!==f&&(b+='"',b+=f,b+='" : "',b+=a[f],b+='"',e>c&&(b+=",")))}return b+="}"}function W(a){if(null===a)return!0;if(a.length>0)return!1;if(0===a.length)return!0;var b;for(b in a)if(a.hasOwnProperty(b))return!1;return!0}function X(a){return{magicKey:a,statsSubmissionInterval:Ka,endpoint:Sa,localUserIDObject:xa}}function Y(a,b,c){var d=Ta[a];void 0===d&&(Ta[a]={},Ta[a].participants=null,c&&(Ta[a].userJoinedSent=!0),b&&(Ta[a].refreshPresence=b))}function Z(a){var b,c=a.statistics.outbound;if(void 0!==c)for(b in c)c.hasOwnProperty(b)&&(navigator.mozGetUserMedia&&c[b].data.mozRtt?c[b].data.mozRtt=0:c[b].data.googRtt&&(c[b].data.googRtt=0))}function $(a){return clearInterval(a),null}function _(){var a;for(a in Ta)Ta.hasOwnProperty(a)&&(Ta[a].refreshPresence=$(Ta[a].refreshPresence),delete Ta[a].refreshPresence);ma()}function aa(){var a,b=function(a){return setInterval(function(){Qb(a)},Ma)};for(a in Ta)Ta.hasOwnProperty(a)&&(Qb(a),Ta[a].refreshPresence=b(a));na()}function ba(a){var b=Ta[a],c=!1;return void 0!==b&&b.participants&&b.participants.length>0&&(c=!0),c}function ca(a,b){var c=Ta[a],d=[];if(void 0===c)d.push(b),Ta[a].participants=d;else{var e=c.participants;null===e?(d.push(b),c.participants=d):e.push(b)}}function da(a){var b=!1;if(!Ta[a])return{conferenceFinished:b,ucID:null};var c=Ta[a].ucID;return 0===Ta[a].participants.length&&($(Ta[a].refreshPresence),ma(),delete Ta[a],b=!0),{conferenceFinished:b,ucID:c}}function ea(a,b){Ob(eb.userLeft,null,a,b,null,null,null),$a=$($a),ma(),Za=Gb,Gb=null}function fa(a,b){var c=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));c||(c={}),c[a]||(c[a]={}),c[a].ucID=b,window.sessionStorage.setItem("csio_ucid_data",JSON.stringify(c)),Ba[a]=ya+va+"/conferences/"+encodeURIComponent(a)+"/"+b+"/general"}function ga(a){var b=JSON.parse(window.sessionStorage.getItem("csio_ucid_data"));return b[a]?b[a].ucID:null}function ha(){return Ha}function ia(a,b,c,e){a===fb.clockSync?ha()?(Va.syncStartTime=d(),c.syncStartTime=Va.syncStartTime,c.offsetResultsLength=Va.offsetResults.length,Ga.emit(a,JSON.stringify(c)),e&&b!==db.fabricStats&&e(hb.success,b+" sent to the backend.")):setTimeout(function(){zc()},100):Pa._isTokenValid(Pa.authToken,va,wa)?Wa&&c.action!==eb.userJoined&&c.action!==eb.refreshPresence&&c.action!==db.fabricSetupFailed&&c.action!==db.applicationErrorLog||!ha()?(c.clockUnsynced=Wa,Jb({type:b,action:a,data:c,callback:e})):(Ga.emit(a,JSON.stringify(c)),e&&b!==db.fabricStats&&e(hb.success,b+" sent to the backend.")):Pa.sendAuthenticationRequest(va,wa,function(d,f){d!==hb.success?(d===ib.authOngoing&&(c.clockUnsynced=Wa,Jb({type:b,action:a,data:c,callback:e})),e&&d!==ib.authOngoing&&e(d,f)):d===hb.success&&"SDK authentication successful."===f&&(Wa&&b!==eb.userJoined&&c.action!==eb.refreshPresence&&c.action!==eb.fabricSetupFailed||!ha()?(c.clockUnsynced=Wa,Jb({type:b,action:a,data:c,callback:e})):(c.token=Pa.authToken,Ga.emit(a,JSON.stringify(c)),e&&b!==db.fabricStats&&e(hb.success,b+" sent to the backend.")))})}function ja(a){a&&a(ib.authOngoing,null)}function ka(a){if(null===a||"object"!=typeof a)return a;var b,c=new a.constructor;for(b in a)a.hasOwnProperty(b)&&(c[b]=ka(a[b]));return c}function la(){var a={};Object.keys(Ta).forEach(function(b){var c=Ta[b];if(!c)return!0;var d,e,f={ucID:c.ucID,userJoinedSent:c.userJoinedSent},g=[];if(c.participants){var h,i=c.participants;for(d=0;d<i.length;d++)e={},h=i[d],e={pcID:h.pcHash,pcState:h.pcState,iceConnectionState:h.iceConnectionState,iceGatheringState:h.iceGatheringState,iceCandidatesNumber:h.iceCandidates.length,remoteUserID:h.remoteUserID},g.push(e)}f.participants=g,a[b]=f});var b={authStatus:Pa.tokenData?!0:!1,clockSync:!Wa,stateMachine:a,pageURL:window.location.href,eventType:"warn",version:ua};Bb(va,wa,"stateMachine",b)}function ma(){_a||(_a=setInterval(function(){la()},ab))}function na(){$(_a),_a=null}var oa,pa,qa,ra="https://collector.callstats.io:443/",sa="https://auth.callstats.io/",ta="443",ua="3.15.5",va=null,wa=null,xa=null,ya="https://dashboard.callstats.io/apps/",za="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",Aa=null,Ba={},Ca=!1,Da=!1,Ea=3e4,Fa=1e4,Ga=null,Ha=!1,Ia=!1,Ja="collectCallStats",Ka=15e3,La=!1,Ma=1e4,Na=5e3,Oa=function(){var a=this,b="urn:x-callstats:auth:errorActions",c=.9,d=300;this.authInProgress=!1,this.tokenData=null,this.authToken=null,this.tokenGenerator=function(a,b){b("Token generator not set")};var f=null,g=null,h=!1,i=window.atob,j=window.btoa,k=function(a){return j(a).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},l=function(a){for(var b=i(a.replace(/[ \r\n]+$/,"")),c=[],d=0;d<b.length;++d){var e=b.charCodeAt(d).toString(16);1===e.length&&(e="0"+e),c.push(e)}return c.join("")},m={};m.cryptotype=null,window.crypto&&window.crypto.subtle?(m.cryptotype="standard",m.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(m.cryptotype="webkit",m.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(m.cryptotype="ie",m.subtlecrypto=window.msCrypto.subtle):(m.subtlecrypto=null,console.info("WebCryptography API not supported in this browser.")),m.sign=function(a,b,c,d){if("HS256"!==a.alg)return d("Use header.alg=HS256");a=JSON.stringify(a),"string"!=typeof b&&(b=JSON.stringify(b));for(var e=k(a)+"."+k(b),f=new ArrayBuffer(e.length),g=new Uint8Array(f),h=e.length-1;h>=0;h--)g[h]=e.charCodeAt(h);var i=function(a){for(var b="",c=new Uint8Array(a),f=c.byteLength,g=0;f>g;g++)b+=String.fromCharCode(c[g]);return e+="."+k(b),d(null,e)},j=function(a){return d(a)},l={name:"HMAC"};("ie"===m.cryptotype||"webkit"===m.cryptotype)&&(l.hash={name:"sha-256"});var n=m.subtlecrypto.sign(l,c,g);"ie"===m.cryptotype?(n.onerror=j,n.oncomplete=function(a){i(a.target.result)}):n.then(i)["catch"](j)},m.decode=function(a){try{return JSON.parse(i(a.split(".")[1]))}catch(b){return null}},m.importKey=function(a,b,c){if("webkit"===m.cryptotype)for(;a.length<32;)a+="\x00";var d={kty:"oct",k:k(a),alg:"HS256"},e={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===m.cryptotype?d.extractable=!1:d.ext=!1,"webkit"===m.cryptotype&&(e=null,d.use="sig"),"ie"===m.cryptotype||"webkit"===m.cryptotype){var f=JSON.stringify(d);d=new Uint8Array(f.length);for(var g=0;g<f.length;g++)d[g]=f.charCodeAt(g)}var h=m.subtlecrypto.importKey("jwk",d,e,!1,["sign"]);"ie"===m.cryptotype?(h.onerror=c,h.oncomplete=function(a){b(a.target.result)}):h.then(b)["catch"](c)},this._isTokenValid=function(a,b,c){var d=!1;if(null===a)return!1;try{var f=m.decode(a);if(null!==f&&f.appID===b&&f.userID===encodeURIComponent(c)){var g=null;if(navigator.mozGetUserMedia){var h=f.expiry.split(" ").join("T");g=Date.parse(h)}else g=new Date(f.expiry);var i=new Date(e());g>i&&(d=!0)}return d}catch(j){}return!1},this.setupAuthToken=function(a){window.localStorage.setItem("csio_auth_data",JSON.stringify(a)),this.authToken=a,this.tokenData=m.decode(a),Ka=parseInt(this.tokenData.submissionInterval,10),La=this.tokenData.collectSDP},this.sendAuthenticationRequest=function(d,e,g){if(d&&e){if(a.authInProgress)return void ja(g);null!==f&&(clearTimeout(f),f=null),n(),a.authInProgress=!0,a.tokenGenerator(h,function(i,j){if(null!==i)return a.authInProgress=!1,void(g&&g(hb.tokenGenerationError,i.toString()));var k=sa+"authenticate",l={client_id:e+"@"+va,code:j,grant_type:"authorization_code"};xc(k,l,function(i){var j=null;a.authInProgress=!1;try{j=JSON.parse(i.response)}catch(k){}if(!j)return void(f=setTimeout(a.sendAuthenticationRequest,Na,d,e,g));if(200===i.status){if("bearer"!==j.token_type)return void(f=setTimeout(a.sendAuthenticationRequest,Na,d,e,g));a.setupAuthToken(j.access_token);var l=parseInt(1e3*parseInt(j.expires_in)*c);o(l,d,e,g),h=!1,g&&g(hb.success,"SDK authentication successful."),ha()?(Ib(),g&&g(hb.success,"WebSocket establishment successful.")):Bc(ra+Ja,function(a,b){void 0!==g&&g(a,b)})}else{if(j[b]&&j[b].length>0)return p(d,e,g,j[b]);f=setTimeout(a.sendAuthenticationRequest,Na,d,e,g)}})})}};var n=function(){null!==g&&(clearTimeout(g),g=null)},o=function(b,c,d,e){n(),g=setTimeout(function(){a.sendAuthenticationRequest(c,d,e)},b)},p=function(a,b,c,d){if(0!==d.length){var e=d.shift();return e.action===Db.RETRY?(o(e.params.timeout,a,b,c),p(a,b,c,d)):e.action===Db.GET_NEW_TOKEN?(h=!0,p(a,b,c,d)):e.action===Db.REPORT_ERROR?p(a,b,c,d):void 0}};this.appSecretTokenGenerator=function(b){var c=null,f=null,g=!1,h=null;b.indexOf(":")>-1&&(h=l(b.split(":")[0]),b=b.split(":")[1]);var i=function(a){b=null,c=a},j=function(a){g=!0,b=null};return m.importKey(b,i,j),function(b,i){if(g)return i("appsecret based token generation failed");if(!b&&null!==f)return i(null,f);if(null===c)return setTimeout(function(){a.tokenGenerator(b,i)},100);var j={userID:wa,appID:va,exp:parseInt(e()/1e3)+d,nbf:parseInt(e()/1e3)-d};h&&(j.keyID=h),m.sign({alg:"HS256"},j,c,function(a,b){return a?i(a):(f=b,i(null,b))})}}},Pa=new Oa,Qa=detectBrowserInfo(),Ra=measureAppLoadingPerformance(Qa),Sa={type:"browser",name:Qa.name,ver:Qa.ver,os:Qa.os,osVersion:Qa.osVersion,userAgent:Qa.userAgent},Ta={},Ua={statsSubmissionIntervalInMS:[1e3,2e3,5e3,1e4],statsSubmissionPhaseDurationInMS:[1e4,3e4,8e4,18e4],currentActivePhaseIndex:0},Va={currentOffset:0,offsetResults:[],syncStartTime:null,syncAttempts:5,syncHandler:null,maxAllowedLatency:6e4},Wa=!0,Xa=[],Ya={},Za=null,$a=null,_a=null,ab=2e4,bb=100,cb=null;"Firefox"===Qa.name?cb=mozRTCPeerConnection:"Chrome"===Qa.name||"Opera"===Qa.name?cb=webkitRTCPeerConnection:"Safari"===Qa.name||"Edge"===Qa.name&&(cb=window.RTCPeerConnection);var db={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricStats:"fabricStats",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",userIDChangedEvent:"userIDChangedEvent",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},eb={fabricDisrupted:"fabricDisrupted",autoFabricSetup:"autoFabricSetup",autoFabricSetupFailed:"autoFabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",fabricStatsCaching:"fabricStatsCaching",updatedConfiguration:"updatedConfiguration",
refreshPresence:"refreshPresence",ssrcMap:"ssrcMap",mediaPlaybackStartEvent:"mediaPlaybackStartEvent",mediaSuspendedEvent:"mediaSuspendedEvent"},fb={sdpSubmission:"sdpSubmissionEvent",rtpStats:"rtpStats",processedStats:"processedStats",callStatsEvent:"callStatsEvent",registerPresence:"registerPresence",userFeedback:"userFeedbackEvent",clockSync:"clockSync"},gb={success:"success",failure:"failure"},hb={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK"},ib={authOngoing:"authOngoing"},jb={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},kb={local:"local",remote:"remote"},lb={excellent:5,good:4,fair:3,poor:2,bad:1},mb={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},nb={excellent:3,fair:2,bad:1},ob={excellent:"excellent",fair:"fair",bad:"bad"},pb={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted"},qb={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},rb={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog"},sb={video:{gThreshold:1024,rThreshold:256},audio:{gThreshold:30,rThreshold:8}},tb={video:{gThreshold:.8,rThreshold:.3}},ub={video:{gThreshold:400,rThreshold:1e3}},vb={video:{gThreshold:10,rThreshold:50},audio:{gThreshold:15,rThreshold:30}},wb={audio:{gThreshold:240,rThreshold:400}},xb={chrome:"Chrome",firefox:"Firefox",edge:"Edge"},yb={unknown:"unknown",audio:"audio",video:"video"},zb=function(a,b){var c=null,e=null,f=null,g=new XMLHttpRequest;g&&(g.open("GET",encodeURI(a)),c=d(),g.onload=function(){e=d(),f=e-c,b(g,f)},g.send())},Ab=function(a,b,c){var d=new XMLHttpRequest;d&&(d.open("POST",encodeURI(a)),d.setRequestHeader("Content-Type","application/json"),d.onload=function(){c(d)},d.send(b))},Bb=function(a,b,c,d){var e=ra+"generics",f={appID:a,userID:encodeURIComponent(b),version:ua,eventType:c,data:d};Ab(e,JSON.stringify(f),function(a){200===a.status||200!==a.status})};window.addEventListener("error",function(a){if(a&&a.filename&&a.filename.indexOf("callstats")>-1){var b,c=!1,d={fileName:a.filename,line:a.lineno,col:a.colno,jsVersion:ua,eventType:"error",message:a.message,pageURL:window.location.href};for(b in Ta)Ta.hasOwnProperty(b)&&(d.conferenceID=b,Bb(va,wa,"onErrorLog",d),c=!0);c||Bb(va,wa,"onErrorLog",d)}});var Cb={invalidWebRTCFunctionName:"Invalid WebRTC function name"},Db={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2},Eb="fabricSetupFailed error reported by the developer",Fb="Connectivity Failure",Gb=c(),Hb=function(a,b){if(!Pa.authToken)return void Pa.sendAuthenticationRequest(va,wa);if(!Wa){var c,d,f,g,h=e(),i=[],j=Math.max(Ka/Xa.length,bb);for(c=0;c<Xa.length;c++)if(f=Xa[c],f.data.action!==eb.userJoined){if(f.data.token=Pa.authToken,a&&f.data.apiTS>=h-b||!f.data.ucID){if(g=decodeURIComponent(f.data.conferenceID),!Ta[g])continue;f.data.ucID=Ta[g].ucID}if(f.data.clockUnsynced&&(f.data.apiTS+=Va.currentOffset),f.action===db.fabricStats&&f.data.clockUnsynced&&f.data.processedStatistics&&f.data.processedStatistics.length>0)for(d=0;d<f.data.processedStatistics.length;d++)f.data.processedStatistics[d].apiTS+=Va.currentOffset;delete f.data.clockUnsynced,l(f,j*(c+1))}else i.push(Xa[c]);Xa=i}},Ib=function(){if(!Pa.authToken)return void Pa.sendAuthenticationRequest(va,wa);var a,b,c=[],d=Math.max(Ka/Xa.length,bb);for(a=0;a<Xa.length;a++)b=Xa[a],b.data.action===eb.userJoined||b.data.action===db.fabricSetupFailed||b.data.action===db.applicationErrorLog?(b.data.token=Pa.authToken,b.data.clockUnsynced&&(b.data.apiTS=b.data.apiTS+Va.currentOffset),b.data.value&&(b.data.value.statsSubmissionInterval=Ka),l(b,d*(a+1))):c.push(Xa[a]);Xa=c},Jb=function(a){Xa.push(a)},Kb=function(a,b){var c=RegExp.prototype.test.bind(/^([a-z])=(.*)/),f=/^ssrc:(\d*) ([\w_]*):(.*)/,g=/^ssrc-group:SIM (\d*)/;a.split(/(\r\n|\r|\n)/).filter(c).forEach(function(a){var c=a[0],h=a.slice(2);if("a"===c){if(f.test(h)){var i=h.match(f),j=i[1];void 0===Ya[j]&&(Ya[j]={}),Ya[j][i[2]]=i[3],Ya[j].localStartTime=d(),Ya[j].syncedStartTime=e(),Ya[j].streamType=b}g.test(h)&&(void 0===Ya.ssrcGroup&&(Ya.ssrcGroup={},Ya.ssrcGroup[b]={}),Ya.ssrcGroup[b].simulcastGroup=h.match(/\d+/g))}})},Lb=function(a){return Ya[a]},Mb=function(){return Ya},Nb=function(a,b,c,d,e,f){if(!e.localDescription||!e.remoteDescription)return!1;var g=e.localDescription.sdp,h=e.remoteDescription.sdp;if(!g||!h||g===d.localSDP&&h===d.remoteSDP)return!1;if(Kb(g,mb.outbound),Kb(h,mb.inbound),La){var i={sdp:{}};i.sdp.localSDP=g!==d.localSDP?g:-1,i.sdp.remoteSDP=h!==d.remoteSDP?h:-1,Pb(a,b,c,i,d.pcHash,f)}return d.localSDP=g,d.remoteSDP=h,!0},Ob=function(a,b,c,d,f,g,h){if(!a)return void console.error("sendEvent: Invalid eventType ");var i=e(),j={version:ua,apiTS:i,action:a,localID:encodeURIComponent(wa),remoteID:encodeURIComponent(b),conferenceID:encodeURIComponent(c),timeShift:0,appID:va,ucID:d,pcID:g,deviceID:Aa,value:f};return null===b&&(j.remoteID=null),null===c?void Bb(va,wa,"log",{msg:"conferenceID is null in sendEvent for "+a}):void(Pa.authToken&&ha()&&(d&&!Wa||a===eb.userJoined||a===db.fabricSetupFailed||a===db.applicationErrorLog||a===eb.refreshPresence)?(j.token=Pa.authToken,ia(fb.callStatsEvent,a,j,h)):(j.clockUnsynced=Wa,Pa.authToken||Pa.sendAuthenticationRequest(va,wa),a!==eb.fabricStatsCaching&&a!==eb.refreshPresence&&Jb({type:fb.callStatsEvent,action:fb.callStatsEvent,data:j,callback:h})))},Pb=function(a,b,c,d,f,g){var h=e(),i={version:ua,appID:va,conferenceID:encodeURIComponent(b),ucID:c,apiTS:h,localID:encodeURIComponent(wa),remoteID:encodeURIComponent(a),pcID:f,deviceID:Aa,sdpPayload:d};Pa.authToken&&ha()&&c&&!Wa?(i.token=Pa.authToken,ia(fb.sdpSubmission,fb.sdpSubmission,i,g)):(i.clockUnsynced=Wa,Jb({type:fb.sdpSubmission,action:fb.sdpSubmission,data:i,callback:g}),Pa.authToken||Pa.sendAuthenticationRequest(va,wa))},Qb=function(a){var b={ucID:Ta[a].ucID,magicKey:Gb,endpoint:Sa,fabricState:{},connectedDevices:oa},c=Ta[a];if(oa||j(),c&&c.participants){var d,e=c.participants,f=0;for(f=0;f<e.length;f++)d=e[f],b.fabricState[f]={pc:d.pcHash,userId:d.remoteUserID,pcState:d.pcState,iceConnectionState:d.pc.iceConnectionState,iceGatheringState:d.pc.iceGatheringState,iceCandidatesNumber:d.iceCandidates.length,numNegotiationNeededCalls:d.numNegotiationNeededCalls}}Wa||(b.clockSyncOffset=Va.currentOffset),Ob(eb.refreshPresence,null,a,Ta[a].ucID,b,null)},Rb=function(a){var b={appID:va,userID:encodeURIComponent(wa),version:ua,endpoint:Sa,pagePerf:Ra,endpointID:Aa,wsID:a.io.engine.id};va&&Pa.authToken&&(b.token=Pa.authToken,a.emit(fb.registerPresence,JSON.stringify(b)))},Sb=function(){var a=window.localStorage.getItem("feedback"),b=JSON.parse(window.localStorage.getItem("csio_auth_data"));if(null!==a){var c=JSON.parse(a),d=b.challenge.token===c.token?!0:!1;d||wa!==c.userID||(c.token=b.challenge.token,d=!0),d?ia(fb.userFeedback,fb.userFeedback,c):window.localStorage.removeItem("feedback")}},Tb=function(a,b){var c={};return c.status=a,b&&(c.message=b),c},Ub=function(a,b){var c,d,e,f=0;for(c=0,e=a.length;e>c;c++)d=a.charCodeAt(c),f=(f<<5)-f+d,f|=0;return b&&b(f),f},Vb=function(a,b,c,e,f,g){if("function"!=typeof b){if(!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle))return e(hb.tokenGenerationError,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API"),Tb(gb.failure,"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API");b=Pa.appSecretTokenGenerator(b)}if(!a||!c)return console.error("initialize: Argument missing/invalid"),Tb(gb.failure,"initialize: Argument missing/invalid");if(Pa.tokenGenerator=b,window.localStorage.getItem("csio_auth_data"))try{var h=JSON.parse(window.localStorage.getItem("csio_auth_data"));Pa._isTokenValid(h,a,c)&&(e&&e(hb.success,"SDK authentication successful."),Pa.setupAuthToken(h),ha()||Bc(ra+Ja,e))}catch(i){}if("string"==typeof a&&(a=parseInt(a,10)),va=a,"object"==typeof c?(wa=c.aliasName,xa=c):wa=c,g&&(g.disableBeforeUnloadHandler===!0&&(Ca=!0),(null!==g.applicationVersion||void 0!==g.applicationVersion)&&(Sa.appVer=g.applicationVersion)),k(),Aa=window.localStorage.getItem("endpointID"),null===Aa){var l=d(),m=Math.random()*l;lc(m.toString(),function(a){Aa=a,window.localStorage.setItem("endpointID",Aa)})}return j(),qa=f,Pa.sendAuthenticationRequest(a,c,e),Tb(gb.success)},Wb=function(a){return function(b){return b.remoteUserID===a?!0:void 0}},Xb=function(a,b){var c=!1,d=null;return Ta[a]&&Ta[a].participants&&(d=Ta[a].participants.filter(Wb(b))),c=d&&d.length>0?!0:!1},Yb=function(a){return function(b){return b.pc===a?!0:a.callstatsID&&b.pcHash===a.callstatsID?!0:void 0}},Zb=function(a,b){var c=null,d=null;return Ta[a]&&Ta[a].participants&&(d=Ta[a].participants.filter(Yb(b))),c=d&&d.length>0?d[0]:null},$b=function(a,b){var c=null,d=null;return c=Zb(a,b),c&&(d=c.pcHash),d},_b=function(a){var b=null,c=null,d=null;for(b in Ta)if(Ta.hasOwnProperty(b)&&(d=Zb(b,a))){c={fabric:d,conferenceID:b};break}return c},ac=function(a,b){var c=0;if(a&&Ta[b].participants)for(c=0;c<Ta[b].participants.length;c++)if(Ta[b].participants[c].pcHash===a.pcHash){Ta[b].participants.splice(c,1);break}},bc=function(a){var b=Qa.codebase,c=null,d=0;if(b===xb.firefox&&"Safari"!==Qa.name)c=[],a.forEach(function(a){c.push(a)});else if(b===xb.chrome&&"Safari"!==Qa.name)c=a.result();else{c=[];for(d in a)a.hasOwnProperty(d)&&c.push(a[d])}return c},cc=function(a){var b=null,c=null,d=null,e=[],f=[],g=0,h=Qa.codebase;for(b=bc(a),g=0;g<b.length;++g)c=V(b[g]),d=S(JSON.parse(c),h),d.hasOwnProperty("localCandidate")?e.push(d.localCandidate):d.hasOwnProperty("remoteCandidate")&&f.push(d.localCandidate);return{localCandidates:e,remoteCandidates:f}},dc=function(a){function b(b){var c={};c=cc(b),a(c.localIceCandidates,c.remoteCandidates)}return b},ec=function(a,b,c,d,e,f,g,h){var i=Qa.codebase,j=Qa.name;i===xb.firefox||"Safari"===j?a.getStats(null,c(b,d,e,f,g,h,a),function(a){Bb(va,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})}):i===xb.chrome?a.getStats(c(b,d,e,f,g,h,a)):i===xb.edge&&a.getStats().then(c(b,d,e,f,g,h,a))["catch"](function(a){Bb(va,d,"log",{msg:"### "+i+" getStats reports error "+JSON.stringify(a)})})},fc=function(a,b){ec(a,b,dc)},gc=function(a,b,c,e){if(!a||!b||!c)return console.error("sendFabricEvent: Arguments missing/Invalid"),Tb(gb.failure,"sendFabricEvent: Arguments missing/Invalid");if(!va||!wa||!Ta[c])return console.error("sendFabricEvent: SDK is not initialized or no Fabrics added."),Tb(gb.failure,"sendFabricEvent: SDK is not initialized or no Fabrics added.");if(b===db.fabricSetupFailed)return console.error("sendFabricEvent: Unsupported fabricEvent fabricSetupFailed"),Tb(gb.failure,"sendFabricEvent: Unsupported fabricEvent fabricSetupFailed");if(!p(a))return console.error("sendFabricEvent: Invalid PeerConnection object passed"),Tb(gb.failure,"sendFabricEvent: Invalid PeerConnection object passed");if(!db.hasOwnProperty(b)&&!eb.hasOwnProperty(b))return console.error("sendFabricEvent: Invalid fabricEvents value: ",b),Tb(gb.failure,"sendFabricEvent: Invalid fabricEvents value: "+b);var f=null,g=null,h=d(),i=Ta[c],j=null;if(void 0===i)return console.error("sendFabricEvent: Conference ID not found!"),Tb(gb.failure,"sendFabricEvent: Conference ID not found!");if(j=Zb(c,a),null===j)return console.error("sendFabricEvent: fabricData is null"),Tb(gb.failure,"sendFabricEvent: fabricData is null");g=j.remoteUserID;var k=j.startTime;if(!(b===db.fabricSetup||b===eb.autoFabricSetup&&j.fabricSetupSent)){if(b===eb.autoFabricSetup){var l=h-j.startTime;if(f={setupDelay:l,iceCandidates:j.iceCandidates,iceGatheringDelay:j.gatheringIceCandidatesDelay,iceConnectivityDelay:j.connectivityIceStatusDelay},j.iceCandidates&&0===j.iceCandidates.length)return void fc(a,function(a,d){f.localCandidates=a,f.remoteCandidates=d,j.localCandidates=a,j.remoteCandidates=d,j.pcState=pb.established,j.fabricSetupSent=!0,Ob(b,g,c,i.ucID,f,j.pcHash,j.pcCallback)});j.pcState=pb.established,j.fabricSetupSent=!0}else if(b===eb.autoFabricSetupFailed)f={failureDelay:j.setupFailureTime,reason:rb.iceFailure,domError:Fb};else if(b===eb.fabricDisrupted)f={disruptionDelay:j.connectivityIceStatusDelay};else if(b===eb.updatedConfiguration)f=j.transportData;else if(b===db.fabricSetupFailed){var m=h-k;f={failureDelay:m,reason:rb.iceFailure,domError:Eb,fabricState:j.pcState,iceConnectionState:j.pc.iceConnectionState,"function":qb.iceConnectionFailure,magicKey:Gb,endpoint:Sa}}else if(b===db.activeDeviceList){if(!e||!e.deviceList)return console.error("sendFabricEvent: Arguments missing/Invalid"),Tb(gb.failure,"sendFabricEvent: Arguments missing/Invalid");f={magicKey:Gb,endpoint:Sa,activeDevicelist:e.deviceList}}if(Ob(b,g,c,i.ucID,f,j.pcHash,j.pcCallback),(b===db.fabricTerminated||b===eb.autoFabricSetupFailed||b===db.fabricSetupFailed)&&Ta[c].participants){j&&(j.statsInterval=$(j.statsInterval),ac(j,c));var n=da(c);n.conferenceFinished&&ea(c,n.ucID)}if((b===db.fabricSetup||b===db.fabricUsageEvent)&&!j.fabricUsageSent){var o=j.fabricUsage;j.fabricUsageSent=!0,Ob(db.fabricUsageEvent,g,c,i.ucID,o,j.pcHash,null)}return Tb(gb.success)}},hc=function(a,b,c){return b?b:a&&a[c]?a[c].sdp:-1},ic=function(a,b,e,f,g,h){if(void 0===a||!e||!b)return console.error("reportError: Arguments missing/invalid"),Tb(gb.error,"reportError: Arguments missing/invalid");if(!va||!wa)return console.error("reportError: SDK is not initialized"),Tb(gb.error,"reportError: SDK is not initialized");if(!qb.hasOwnProperty(e))return console.error("reportError: Invalid webRTC functionName value: %o",e),Tb(gb.error,"reportError: Invalid webRTC functionName value: "+e);void 0===f&&console.warn("reportError: Missing dom error parameter");var i,j=null,k=null,l=d(),m=Ta[b],n=null;if(i=R(e),f&&f instanceof DOMException)f={message:f.message,name:f.name};else if(f&&"object"==typeof f){var o={};f.hasOwnProperty("message")&&(o.message=f.message),f.hasOwnProperty("name")&&(o.name=f.name),f.hasOwnProperty("constraintName")&&(o.constraintName=f.constraintName),f.hasOwnProperty("stack")&&(o.stack=f.stack),f=o}if(p(a)){if(void 0===m)return console.error("reportError: Conference ID not found!"),Tb(gb.error,"reportError: Conference ID not found!");if(n=Zb(b,a),null===n)return console.error("reportError: Invalid pcObject passed as argument"),Tb(gb.error,"reportError: Invalid pcObject passed as argument");k=n.remoteUserID;var q=n.startTime,r=l-q;if(j={failureDelay:r,reason:i,domError:f,fabricState:n.pcState,iceConnectionState:n.pc.iceConnectionState,"function":e,magicKey:Gb,endpoint:Sa},e===qb.applicationLog||e===qb.applicationError?Ob(db.applicationErrorLog,k,b,m.ucID,j,n.pcHash,n.pcCallback):Ob(db.fabricSetupFailed,k,b,m.ucID,j,n.pcHash,n.pcCallback),g||h||a&&a.localDescription||a&&a.remoteDescription){var s={sdp:{}};s.sdp.localSDP=hc(a,g,"localDescription"),s.sdp.remoteSDP=hc(a,h,"remoteDescription"),Pb(k,b,m.ucID,s,n.pcHash)}}else{null===Gb&&(Gb=c());var t=c();j={failureDelay:0,reason:i,domError:f,"function":e,magicKey:Gb,endpoint:Sa},e===qb.applicationLog||e===qb.applicationError?Ob(db.applicationErrorLog,k,b,null,j,t,null):Ob(db.fabricSetupFailed,k,b,null,j,t,null)}return Tb(gb.success)},jc=function(a){for(var b=[],c=0;c<a.length;c++){var d=a.charCodeAt(c);128>d?b[b.length]=d:d>127&&2048>d?(b[b.length]=d>>6|192,b[b.length]=63&d|128):(b[b.length]=d>>12|224,b[b.length]=d>>6&63|128,b[b.length]=63&d|128)}return new Uint8Array(b).buffer},kc=function(a){for(var b,c=new DataView(a),d="",e=0;e<c.byteLength;e++)b=c.getUint8(e).toString(16),b.length<2&&(b="0"+b),d+=b;return d},lc=function(a,b){var c={name:"SHA-256"};if(window.crypto){var d=window.crypto.subtle||window.crypto.webkitSubtle;if(!d)return void Ub(a,b);d.digest(c,jc(a)).then(function(a){b(kc(a))})["catch"](function(){Ub(a,b)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void Ub(a,b);var e=window.msCrypto.subtle.digest(c,jc(a));e.oncomplete=function(a){a.target&&b(kc(a.target.result))},e.onerror=function(){Ub(a,b)}}else Ub(a,b)},mc=function(a,b,c){if(!b||!a)return console.error("sendUserFeedback: Arguments missing/Invalid"),Tb(gb.error,"sendUserFeedback: Arguments missing/Invalid");if("object"!=typeof b)return console.error("sendUserFeedback: Invalid feedback object."),Tb(gb.error,"sendUserFeedback: Invalid feedback object.");if(0===Object.keys(b).length)return console.error("sendUserFeedback: Feedback data object must not be empty."),Tb(gb.error,"sendUserFeedback: Feedback data object must not be empty.");if(!b.hasOwnProperty("overall"))return console.error("sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys."),Tb(gb.error,"sendUserFeedback: Feedback data object must contain 'conferenceID', 'userID' and 'overall' keys.");var d=Ta[a],e=null;void 0!==d&&void 0!==d.ucID&&(e=d.ucID);var f=null;if(f=null===Gb?Za:Gb,null===e&&(e=ga(a)),null===e)return console.error("sendUserFeedback: ucID unavailable"),Tb(gb.error,"sendUserFeedback: ucID unavailable");var g={conferenceID:encodeURIComponent(a),magicKey:f,appID:va,version:ua,ucID:e,userID:encodeURIComponent(b.userID),userQoe:{overall:b.overall}};return b.hasOwnProperty("video")?g.userQoe.video=b.video:g.userQoe.video=-1,b.hasOwnProperty("audio")?g.userQoe.audio=b.audio:g.userQoe.audio=-1,b.hasOwnProperty("screen")?g.userQoe.screen=b.screen:g.userQoe.screen=-1,b.hasOwnProperty("comment")?g.userQoe.comment=b.comment:g.userQoe.comment=-1,Pa.authToken&&!Wa?(g.token=Pa.authToken,window.localStorage.setItem("feedback",JSON.stringify(g)),ia(fb.userFeedback,fb.userFeedback,g,c)):(g.clockUnsynced=Wa,Jb({type:fb.userFeedback,action:fb.userFeedback,data:g,callback:c}),Pa.sendAuthenticationRequest(va,wa)),Tb(gb.success)},nc=function(a,b,c,d,e,f){var g=null;if(g="object"==typeof b?b.aliasName:b,!(a&&c&&g&&d&&e))return console.error("associateMstWithUserID: Arguments missing"),Tb(gb.error,"associateMstWithUserID: Arguments missing");if(""===c||""===g||""===d||""===e)return console.error("associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty"),Tb(gb.error,"associateMstWithUserID: conferenceID or remoteUserID or ssrc MUST not be empty");if(!p(a))return console.error("associateMstWithUserID: Invalid PeerConnection object passed"),Tb(gb.error,"associateMstWithUserID: Invalid PeerConnection object passed");var h=Ta[c];if(void 0===h)return console.error("associateMstWithUserID: conferenceID doesn't exist"),Tb(gb.error,"associateMstWithUserID: conferenceID doesn't exist");var i=null;if(i=Zb(c,a),null===i)return console.error("associateMstWithUserID: Unknown pcObject passed"),Tb(gb.error,"associateMstWithUserID: Unknown pcObject passed");var j=Lb(d);return void 0===j&&(Ya[d]={},j=Lb(d)),j.remoteUserID=g,j.ssrc=d,j.associatedVideoTag=f,j.usageLabel=e,f&&g!==wa&&o(g,c,f,a,d),Tb(gb.success)},oc=function(a,b,e,f,g){var h=null,i={authStatus:Pa.tokenData?!0:!1,clockSync:!Wa,msg:"addNewFabric called",eventType:"warn",pageURL:window.location.href,conferenceID:f,version:ua};if(Bb(va,wa,"stateMachine",i),h="object"==typeof b?b.aliasName:b,!(a&&h&&e&&f))return console.error("addNewFabric: Arguments missing/Invalid"),Tb(gb.error,"addNewFabric: Arguments missing/Invalid");if(!va||!wa)return console.error("addNewFabric: SDK not initialized."),Tb(gb.error,"addNewFabric: SDK not initialized");if(""===f||""===h)return console.error("addNewFabric: conferenceID or remoteUserID MUST not be empty"),Tb(gb.error,"addNewFabric: conferenceID or remoteUserID MUST not be empty");if(!p(a))return console.error("addNewFabric: Invalid PeerConnection object passed"),Tb(gb.error,"addNewFabric: Invalid PeerConnection object passed");if(!jb.hasOwnProperty(e)||e instanceof Function)return console.error("addNewFabric: Invalid fabricUsage value"),Tb(gb.error,"addNewFabric: Invalid fabricUsage value");var j=d();null===Gb&&(Gb=c());var k=null,l=!1;if(!ba(f)){var m=X(Gb);Ob(eb.userJoined,null,f,null,m,null,null),l=!0,i={authStatus:Pa.tokenData?!0:!1,clockSync:!Wa,msg:"userJoined sent",pageURL:window.location.href,eventType:"warn",conferenceID:f,version:ua},Bb(va,wa,"stateMachine",i)}if(Y(f,k,l),!Zb(f,a)){a.addEventListener("icecandidate",uc,!1),a.addEventListener("iceconnectionstatechange",tc,!1),a.addEventListener("signalingstatechange",qc,!1),a.addEventListener("negotiationneeded",sc,!1);var n=c(),o={pc:a,remoteUserID:h,fabricUsage:e,magicKey:Gb,startTime:j,pcCallback:g,pcState:pb.initializing,fabricSetupSent:!1,iceCandidates:[],iceConnectionState:a.iceConnectionState,latestEventSent:j,pcHash:n,localSDP:-1,remoteSDP:-1,statsInterval:null,initialPhaseOver:!1,intervalAdaptionPhase:!0,gatheringIceCandidatesDelay:0,connectivityIceStatusDelay:0,numNegotiationNeededCalls:0};"function"!=typeof a||a.callstatsID||(a.callstatsID=n),("connected"===a.iceConnectionState||"completed"===a.iceConnectionState)&&(o.pcState=pb.established),ca(f,o),o.pcState===pb.established&&(gc(a,eb.autoFabricSetup,f),rc(o,a,f,h))}return Tb(gb.success)},pc=function(a,b,c,d){if(!(a&&c&&d&&b))return console.error("reportUserIDChange: Arguments missing/Invalid"),Tb(gb.error,"reportUserIDChange: Arguments missing/Invalid");if(!va||!wa)return console.error("reportUserIDChange: SDK not initialized."),Tb(gb.error,"reportUserIDChange: SDK not initialized");if(""===c||""===b)return console.error("reportUserIDChange: id or  conferenceID MUST not be empty"),Tb(gb.error,"reportUserIDChange: id or  conferenceID MUST not be empty");if(!p(a))return console.error("reportUserIDChange: Invalid PeerConnection object passed"),Tb(gb.error,"reportUserIDChange: Invalid PeerConnection object passed");var e,f=null,g=Ta[b];if(void 0===g)return console.error("reportUserIDChange: Conference ID not found!"),Tb(gb.error,"reportUserIDChange: Conference ID not found!");var h=null;if(void 0===g.ucID)return console.error("reportUserIDChange: addNewFabric was not called"),Bb(va,wa,"log",{msg:"### reportUserIDChange: addNewFabric was not called"}),Tb(gb.error,"reportUserIDChange: addNewFabric was not called");if(h=g.ucID,f=Zb(b,a),null===f)return console.error("reportUserIDChange: Invalid pcObject passed as argument"),Tb(gb.error,"reportUserIDChange: Invalid pcObject passed as argument");var i={id:c,idType:d};return Ob(db.userIDChangedEvent,e,b,h,i,null,f.pcCallback),Tb(gb.success)},qc=function(a){if(a){var b,c=Qa.codebase,d=null;if(c===xb.firefox)b=a.target;else if(c===xb.chrome)b=a.srcElement;else{if(c!==xb.edge)return void console.error("PeerConnection signaling state changed: unsupported code base");b=a.pc}if(void 0!==b){var e=b.signalingState;"closed"===e&&(d=_b(b),d&&d.fabric&&gc(b,db.fabricTerminated,d.conferenceID))}}},rc=function(a,b,c,e){null===a.statsInterval&&(a.statsPollingStart=d(),vc(b,c,e),a.statsInterval=setInterval(vc,Ua.statsSubmissionIntervalInMS[Ua.currentActivePhaseIndex],b,c,e))},sc=function(a){if(a){var b,c=Qa.codebase;if(c===xb.firefox)b=a.target;else if(c===xb.chrome)b=a.srcElement;else{if(c!==xb.edge)return void console.error("PeerConnection negotiation needed: unsupported code base");b=a.pc}if(void 0!==b){var d=null;d=_b(b),d&&d.fabric&&d.fabric.numNegotiationNeededCalls++}}},tc=function(a){if(a){var b,c=Qa.codebase;if(c===xb.firefox)b=a.target;else if(c===xb.chrome)b=a.srcElement;else{if(c!==xb.edge)return void console.error("PeerConnection ICE connection state changed: unsupported code base");b=a.pc}if(void 0!==b){var e,f,g,h,i=null,j=null;j=_b(b),j&&j.fabric&&(i=j.fabric,e=j.conferenceID,f=i.remoteUserID,g=d(),h=g-i.startTime,"complete"===b.iceGatheringState&&"checking"===b.iceConnectionState&&(i.gatheringIceCandidatesDelay=h),"connected"===b.iceConnectionState||"completed"===b.iceConnectionState?(i.connectivityIceStatusDelay=h,i.pcState===pb.initializing?i.fabricSetupSent||gc(i.pc,eb.autoFabricSetup,e):i.pcState===pb.disrupted&&gc(i.pc,eb.fabricDisrupted,e),i.pcState=pb.established,rc(i,b,e,f)):"failed"===b.iceConnectionState?(i.setupFailureTime=h,gc(i.pc,eb.autoFabricSetupFailed,e),i.pcState=pb.failed):"disconnected"===b.iceConnectionState&&(i.startTime=d(),i.pcState=pb.disrupted,i.pcCallback&&i.pcCallback(hb.appConnectivityError,"Connectivity check for PC object to "+f+" failed.")),i.iceConnectionState=b.iceConnectionState)}}},uc=function(a){var b,c,d;if(null!==a.candidate){var e=a.candidate.candidate;c=e.split(" ");var f="1"===c[1]?"rtp":"rtcp";"0"!==c[5]&&(d=-1!==c[4].indexOf(":"),b={transport:c[2],protocol:f,typePreference:c[3],address:d?"["+c[4]+"]:"+c[5]:c[4]+":"+c[5],type:c[7],media:a.candidate.sdpMid})}var g,h=Qa.codebase;if(h===xb.firefox)g=a.target;else if(h===xb.chrome)g=a.srcElement;else{if(h!==xb.edge)return void console.error("PeerConnection ICE candidate found: unsupported code base");g=a.pc}if(void 0!==g){var i=null;i=_b(g),i&&i.fabric&&void 0!==b&&-1===i.fabric.iceCandidates.indexOf(b)&&i.fabric.iceCandidates.push(b)}},vc=function(a,b,c){if(!Ta.hasOwnProperty(b))return void console.error("ConferenceID %o doesn't exist. Can't call getStats for it.",b);if(!Xb(b,c))return void console.error("Remote user ID %o doesn't exist. Can't call getStats for it.",c);if("closed"===a.signalingState)return gc(a,db.fabricTerminated,b),!0;var e=Zb(b,a);if(e.pcState!==pb.established&&e.lastFabricState===e.pcState&&"connected"!==a.iceConnectionState&&"completed"!==a.iceConnectionState)return!0;var f=Ta[b].ucID;ec(a,e.pcCallback,Q,wa,c,b,f,e);var g,h=d(),i=h-e.statsPollingStart,j=5e3;(i>Ua.statsSubmissionPhaseDurationInMS[Ua.currentActivePhaseIndex]&&e.intervalAdaptionPhase||Da===!0)&&($(e.statsInterval),Da?(g=Ea,e.intervalAdaptionPhase=!1,Da=!1):Ua.currentActivePhaseIndex<Ua.statsSubmissionIntervalInMS.length-1?(Ua.currentActivePhaseIndex+=1,g=Ua.statsSubmissionIntervalInMS[Ua.currentActivePhaseIndex]):(g=Ka,e.intervalAdaptionPhase=!1),g>j&&(e.initialPhaseOver=!0),e.statsInterval=setInterval(vc,g,a,b,c))},wc=function(a,b,c){b.hasOwnProperty(a)&&(b[a].hasOwnProperty("video")&&(b[a].video.isGreaterBetter?(c.video.gThreshold=b[a].video.upperThreshold,c.video.rThreshold=b[a].video.lowerThreshold):(c.video.gThreshold=b[a].video.lowerThreshold,c.video.rThreshold=b[a].video.upperThreshold)),b[a].hasOwnProperty("audio")&&(b[a].audio.isGreaterBetter?(c.audio.gThreshold=b[a].audio.upperThreshold,c.audio.rThreshold=b[a].audio.lowerThreshold):(c.audio.gThreshold=b[a].audio.lowerThreshold,c.audio.rThreshold=b[a].audio.upperThreshold)))},xc=function(a,b,c){var d=[];for(var e in b)b.hasOwnProperty(e)&&d.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));var f=d.join("&"),g=new XMLHttpRequest;g.open("POST",a),g.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),g.onload=function(){c(g)},g.send(f)},yc=function(){zb(za,function(a){if(200===a.status){var b=JSON.parse(a.responseText);wc("eModelThreshold",b,wb),wc("throughputThreshold",b,sb),wc("fractionalLossThreshold",b,vb),wc("rttThreshold",b,ub),wc("currOverPrevFrameRateThreshold",b,tb)}})},zc=function(){var a=ra+"clockSync",b=null,c=null;zb(a,function(a,e){200===a.status&&(b=JSON.parse(a.response),c=d(),Ac(b,e,c))})},Ac=function(a,b,c){if(Wa){var d=b/2;if(d>Va.maxAllowedLatency)Va.offsetResults=[],Bb(va,wa,"log",{msg:"clockSync restarting"});else{var e=a.now+d,f=e-c;Va.offsetResults.push(f)}if(Va.offsetResults.length>=Va.syncAttempts){var g=Va.offsetResults.reduce(function(a,b){return a+b});Va.currentOffset=g/Va.offsetResults.length,Va.offsetResults=[],Wa=!1,Bb(va,wa,"log",{msg:"clockSync Done"}),Hb()}else Wa&&setTimeout(function(){zc()},100)}},Bc=function(a,c){return Ha?(Bb(va,wa,"log",{msg:"### _setupChannel is called when already connected!"}),void(c&&c(hb.success,"WebSocket establishment successful."))):Ga?void Bb(va,wa,"log",{msg:"### _setupChannel is called when _connection is not null and not connected! Let's rely on auto reconnect!"}):(Ga=b.connect(a,{port:ta,reconnect:!0,"reconnection delay":500,"max reconnection attempts":500,reconnectionDelayMax:8e3}),Ga.on("connect",function(){Bb(va,wa,"log",{msg:"Successfully connected to the backend",io_ver:b.protocol}),Ha=!0,Va.syncHandler||(Bb(va,wa,"log",{msg:"start clockSync"}),Va.offsetResults=[],zc(),Va.syncHandler=!0),Ib(),Ia?aa():Rb(Ga),Ia=!1}),Ga.on("disconnect",function(){Ha=!1,_(),Wa&&(Va.offsetResults=[],Va.syncHandler=null,Wa=!1),c&&c(hb.httpError,"Connection to the server disappeared.")}),Ga.on("connect_failed",function(){Ha=!1,c&&c(hb.wsChannelFailure,"WebSocket establishment failed.")}),Ga.on("reconnect",function(){Ia=!0}),Ga.on("reconnect_failed",function(){Ha=!1}),void Ga.on("response",function(a){var b=d(),e=JSON.parse(a);if("Error"===e.status)"Invalid client token."===e.reason&&(Pa.tokenData=null,Pa.authToken=null,Pa.sendAuthenticationRequest(va,wa)),c&&c(hb.csProtoError,a.reason);else if("200 OK"===e.status)if("feedback"===e.event)window.localStorage.removeItem("feedback");else if(e.event===eb.userJoined||e.event===eb.refreshPresence){var f,g=!1,h=null,i=decodeURIComponent(e.conferenceID),j=function(a){return setInterval(function(){Qb(a)},Ma)};for(f in Ta)if(Ta.hasOwnProperty(f)&&f===i){Ta[f].ucID!==e.ucID&&(g=!0,fa(f,e.ucID),h=e.conferenceCreationTS?e.conferenceCreationTS:e.conferenceDuration),e.event!==eb.userJoined||Ta[f].refreshPresence||(Ta[f].refreshPresence=j(i),na()),Ta[f].ucID=e.ucID;break}Sb(),Hb(g,h)}else e.event===fb.clockSync&&Ac(e,b)}))};return g(),yc(),zc(),ma(),{version:ua,initialize:Vb,fabricEvent:db,addNewFabric:oc,sendFabricEvent:gc,sendUserFeedback:mc,associateMstWithUserID:nc,csError:hb,fabricUsage:jb,qualityRating:lb,webRTCFunctions:qb,reportError:ic,reportUserIDChange:pc,userIDType:kb,callStatsAPIReturnStatus:gb}};"function"==typeof define&&define.amd?define("callstats",["jquery","socketio","sha"],b):a.callstats=b}(this);
/*! callstats.js  version = 3.15.5 2016-08-31 */
function detectBrowserInfo(){var a,b,c=navigator.userAgent,d=navigator.appName,e=navigator.appVersion,f=""+parseFloat(navigator.appVersion),g={goog:"Chrome",moz:"Firefox",plugin:"Plugin",edge:"Edge"};-1!==(a=c.indexOf("Opera"))?(d="Opera",f=c.substring(a+6),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("OPR"))?(d="Opera",f=c.substring(a+4),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("MSIE"))?(d="Microsoft Internet Explorer",f=c.substring(a+5),b=g.goog):-1!==(a=c.indexOf("Edge"))?(d=g.edge,f=c.substring(a+5),b=g.edge):-1!==(a=c.indexOf("Chrome"))?(d=g.goog,f=c.substring(a+7),b=g.goog):-1!==(a=c.indexOf("Safari"))?(d="Safari",f=c.substring(a+7),-1!==(a=c.indexOf("Version"))&&(f=c.substring(a+8)),b=g.goog):-1!==(a=c.indexOf("Firefox"))?(d="Firefox",f=c.substring(a+8),b=g.moz):-1!==(a=c.indexOf("Trident"))&&(d="Microsoft Internet Explorer",a=c.indexOf("rv"),f=c.substring(a+3,a+7),b=g.goog);var h,i,j=null,k=[{s:"Windows 3.11",r:/Win16/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 10",r:/(Windows 10|Windows NT 10.0)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows ME",r:/Windows ME/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}];for(h in k)if(i=k[h],i.r.test(c)){j=i.s;break}var l=null;switch(/Windows/.test(j)&&(l=/Windows (.*)/.exec(j)[1],j="Windows"),j){case"Mac OS X":l=/Mac OS X (10[\.\_\d]+)/.exec(c)[1];break;case"Android":l=/Android ([\.\_\d]+)/.exec(c)[1];break;case"iOS":l=/OS (\d+)_(\d+)_?(\d+)?/.exec(e),l=l[1]+"."+l[2]+"."+(0|l[3])}return{name:d,ver:f.toString(),os:j,osVersion:l,codebase:b,userAgent:c}}
/*! callstats.js  version = 3.15.5 2016-08-31 */
function measureAppLoadingPerformance(a){var b=0,c=Number.MAX_VALUE,d=0,e="",f="",g=window.performance;if(!("performance"in window&&"timing"in window.performance&&"navigation"in window.performance))return{support:"none",total:void 0};var h=g.timing.loadEventEnd-g.timing.navigationStart;if("Chrome"===a.name||"Opera"===a.name){var i,j=g.getEntriesByType("resource");for(i=0;i<j.length;i++)j[i].duration>d&&(f=j[i].name.substr(j[i].name.lastIndexOf("/")+1),d=j[i].duration),j[i].duration<c&&(e=j[i].name.substr(j[i].name.lastIndexOf("/")+1),c=j[i].duration),j[i].name.indexOf("CALLSTATS_SRC_URLstatic/callstats")>-1&&(b=j[i].duration);return{support:"full",callstats:b,min:{name:e,time:c},max:{name:f,time:d},total:h}}return"Firefox"===a.name?{support:"limited",total:h}:void 0}